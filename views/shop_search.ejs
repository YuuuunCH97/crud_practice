<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>購物車查詢</title>
    <%- include('./header') -%>

    <script>
        function validateForm() {
            var startDate = document.getElementById("start-date").value;
            var endDate = document.getElementById("end-date").value;
            var email = document.getElementById("email").value;

            if (!startDate || !endDate || !email) {
                alert("請填寫日期跟帳號");
                return false;
            }
            return true;
        }
    </script>

    <style>
        /* 增加整体容器的左侧边距 */
        .container {
        margin-left: 20px; /* 可以根据需要调整具体的数值 */
        }
        h1 {
            background-color:#ece8e8;
            color:rgb(153, 151, 151);
            font-size:13px;
            background-size:100%;
        }

        div li {
            display:inline;
            margin-right:10px;
        }

        /*購物車系統*/
        div p {
            width: 120px;
            text-align:center;
            background-color: #dddedf;
            border-radius: 100px;

        }

        div a {
            color:black;
            text-decoration: none;
        }

        /*會員管理系統 新增 查詢*/
        .tit{
            background-color: #dddedf;
            height:30px;
            width:100%;
            font-size: 20px;;
        }

        /*查詢*/
        form button{
            width: 10%;
            padding: 8px;
            margin-top: 10px;
            background-color: #90b0cc;
            border-color:#90b0cc;
            border-style:solid;
            color:#ece8e8;
            border-radius: 100px;
        }

        form button:hover {
        background-color: #5b85c9;
        }

        /*按鈕被點即時的顏色*/
        form button:active {
        background-color: #737e74;
        }



        table {
            width: 80%;
            margin: 20px 0;
            font-size: 18px;
            text-align: center; /* 表格內容置中 */
            border-collapse: collapse;
            /*
            border-top: none;   /* 移除最上邊線 */
            /*border-left: none; /* 移除最左邊線 */
            /*border-right: 1px solid black; /* 只留右邊框線 */
            /*border-bottom: 1px solid black; /* 只留下邊框線 */ 
        }

        th, td {
            border: 1px solid black; /* 對th、td添加1px寬的黑色實線邊框 */
            padding: 15px; /* 增加內邊距 */
            text-align: center; /* 文字置中對齊 */
        }

        table ul li {
            display: block; /* 每個商品顯示為獨立的一行 */
            margin-bottom: 5px; /* 為每個商品之間增加些許間距 */
        }

        table thead tr {
            background-color: #a8aca9;
        }

    </style>
</head>

<body>
    <div class = "tit">
        <ul>
            <li><b>會員管理系統</b>
            <li><a aria-current="page" href="/create_member"> 新增</a>
            <li><a aria-current="page" href="/search_member" >查詢</a>
            <li><a aria-current="page" href="/shop_sys">購物車系統</a>
            <li><a aria-current="page" href="/shop_search" >購物車查詢</a>  
        </ul>
    </div><br>

    <div class="container">
        <div><p><b>購物車系統</b></p></div>

        <form method="POST" action="/shop_search" onsubmit="return validateForm()">
            <label for="start-date">管理日期 開始日</label>
            <input type="date" id="start-date" name="start-date">
            
            <label for="end-date">~結束日</label>
            <input type="date" id="end-date" name="end-date">

            <label for="email">帳號</label>
            <input type="email" id="email" name="email" placeholder="請輸入email">

            <button type="submit">查詢</button>
        </form>


        <table border="1">
            <thead>
                <tr>
                    <th>購買日期</th>
                    <th>流水號</th>
                    <th>Email</th>
                    <th>商品列表</th>
                    <th>總採購金額</th>
                </tr>
            </thead>
            
            <tbody>
                <% data.forEach(function(item) { %>
                    <tr>
                        <td><%= item.purchaseDate %></td>
                        <td><%= item.serialNumber %></td>
                        <td><%= item.email %></td>
                        <td>
                            <ul>
                                <% var totalPurchase = 0; %>
                                <% item.items.forEach(function(product) { %>
                                    <% var subtotal = product.quantity * product.price; %>
                                    <% totalPurchase += subtotal; %>
                                    <li><%= product.name %> - 數量: <%= product.quantity %>, 
                                        價錢: <%= product.price %>, 
                                        金額: <%= subtotal.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) %>
                                    </li>
                                <% }); %>
                            </ul>
                        </td>
                        <td><%= totalPurchase.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) %></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
    


</body>
</html>

