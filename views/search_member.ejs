<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員查詢</title>
    <%- include('./header') -%>

    <script>
    function updateCities() {
        var country = document.getElementById("select_country").value;
        var citySelect = document.getElementById("select_city");
        citySelect.innerHTML = ""; // 清空城市選項

        // 根據選的國家跳城市
        switch (country) {
            case "台灣":
                citySelect.innerHTML += "<option value='台北'>台北</option>";
                citySelect.innerHTML += "<option value='台中'>台中</option>";
                citySelect.innerHTML += "<option value='高雄'>高雄</option>";
                citySelect.innerHTML += "<option value='台南'>台南</option>";
                citySelect.innerHTML += "<option value='宜蘭'>宜蘭</option>";
                citySelect.innerHTML += "<option value='花蓮'>花蓮</option>";
                citySelect.innerHTML += "<option value='屏東'>屏東</option>";
                break;
            case "美國":
                citySelect.innerHTML += "<option value='紐約'>紐約</option>";
                citySelect.innerHTML += "<option value='洛杉磯'>洛杉磯</option>";
                citySelect.innerHTML += "<option value='芝加哥'>芝加哥</option>";
                citySelect.innerHTML += "<option value='加州'>加州</option>";
                break;
            case "英國":
                citySelect.innerHTML += "<option value='倫敦'>倫敦</option>";
                citySelect.innerHTML += "<option value='愛丁堡'>愛丁堡</option>";
                citySelect.innerHTML += "<option value='牛津'>牛津</option>";
                citySelect.innerHTML += "<option value='劍橋'>劍橋</option>";
                break;
            case "中國":
                citySelect.innerHTML += "<option value='北京'>北京</option>";
                citySelect.innerHTML += "<option value='上海'>上海</option>";
                citySelect.innerHTML += "<option value='廣州'>廣州</option>";
                citySelect.innerHTML += "<option value='哈爾濱'>哈爾濱</option>";
                break;
            default:
                // 無國家 空
                break;
        }
    }

    let selectedEmails = []; // 用於存儲選中會員的電子郵件地址

    // 當checkbox選取時將電子郵件地址添加到selectedEmails列表中
    function handleCheckboxChange(email) {
        if (selectedEmails.includes(email)) {
            selectedEmails = selectedEmails.filter(item => item !== email);
        } else {
            selectedEmails.push(email);
        }
    }

    // 點擊刪除按鈕時調用的函數
    function deleteSelectedMembers() {

        const selectedEmails = Array.from(document.querySelectorAll('input[name="delete"]:checked'))
                                    .map(checkbox => checkbox.value);

        if (selectedEmails.length === 0) {
            alert("請選擇要刪除的會員");
            return;
        }

        if (confirm("確定要刪除選取的會員嗎？")) {
            fetch(`/delete_selected_members`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ selectedEmails })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('刪除會員失敗');
                }
                // 刷新頁面或者重新加載資料
                window.location.reload();
            })
            .catch(error => {
                console.error('刪除會員失敗:', error);
            });
        }
    }


    </script>
    <style>
        /* 增加整体容器的左侧边距 */
        .container {
            margin-left: 20px; /* 可以根据需要调整具体的数值 */
        }


        h1 {
            background-color:#ece8e8;
            color:rgb(153, 151, 151);
            font-size:13px;
            background-size:100%;
        }

        div li {
            display:inline;
            margin-right:10px;
        }

        /*超連結黑色 無下底線*/
        div a {
            color: black;
            text-decoration: none;
            }

        div p {
            width: 120px;
            text-align:center;
            background-color: #dddedf;
            border-radius: 100px;
        }



        /*會員管理系統 新增 查詢*/
        .tit{
            background-color: #dddedf;
            height:30px;
            width:100%;
            font-size: 20px;;
        }


            /* 表格全局樣式 */
        table {
                width: 100%;
        }

            /* 表格 1 的樣式 */
        #name1 {
                border-collapse: collapse;

        }

        #name1 td {
            padding: 8px;
            text-align: left;
        }


            /* 表格 2 的樣式 */
        #name2 {
                border-collapse: separate;
                border-spacing: 0;
                border: 1px solid black;
                width:"80%";
        }

        #name2 thead {
            background-color: lightgrey; /* 設置灰色背景 */
        }


            /* 表格單元格的樣式 */
        #name2 td {
                border: 1px solid black;
                padding: 8px;
                text-align: center;
        }

        /* 修改按鈕 */
        #name2 td button {
            width: 50%;
            padding: 8px;
            background-color: #90b0cc; /* 藍色背景 */
            border: none; /* 刪除四邊形灰色的框 */
            color: #ece8e8; /* 文字顏色 */
            border-radius: 100px; /* 四邊圓角 */
            cursor: pointer;
            outline: none; /* 刪除按鍵被選中時的藍色輪廓 */
        }

        /* 滑鼠懸停時的樣式 */
        #name2 td button:hover {
            background-color: #4d66d5;
        }

        /* 按下時的樣式 */
        #name2 td button:active {
            background-color: #737e74;
        }



        #name1 input[type="submit"] {
            width: 25%;
            padding: 8px;
            margin-top: 10px;
            background-color: #90b0cc;
            border-color:#90b0cc;
            border-style:solid;
            color:#ece8e8;
            border-radius: 100px;
        }

        /*滑鼠懸停顯示*/
        #name1 input[type="submit"]:hover {
            background-color: #45a049;
        }
        /*按鈕被點即時的顏色*/
        #name1 input[type="submit"]:active {
            background-color: #737e74;
        }

        button[name="sex"] {
            width: 50%;
            padding: 8px;
            margin-top: 10px;
            background-color: #90b0cc;
            border-color:#90b0cc;
            border-style:solid;
            color:#ece8e8;
            border-radius: 100px;
        }

        /*滑鼠懸停顯示*/
        button[name="sex"]:hover {
            background-color: #45a049;
        }
        /*按鈕被點即時的顏色*/
        button[name="sex"]:active {
            background-color: #737e74;
        }


        /*delete button*/
        .delete-button-container {
            position: fixed;
            bottom: 20px; /* 與底部的距離 */
            left: 50%; /* 與左邊的距離 */
            transform: translateX(-50%); /* 水平居中 */
            z-index: 999; /* 確保在最上層 */
            width: 25%;
            padding: 8px;
            margin-top: 10px;
            background-color: transparent; /* 背景透明 */
            border: none; /* 刪除外框 */
            cursor: pointer;
            outline: none; /* 刪除按鍵被選中時的藍色輪廓 */
        }

        .delete-button-container button {
            background-color: #90b0cc; /* 藍色背景 */
            color: #ece8e8; /* 文字顏色 */
            border: none; /* 刪除四邊形灰色的框 */
            border-radius: 100px; /* 四邊圓角 */
            padding: 8px 16px; /* 調整按鈕內容的間距 */
        }

        /*滑鼠懸停顯示*/
        .delete-button-container button:hover {
            background-color: #4d66d5;
        }
        /*按鈕被點即時的顏色*/
        .delete-button-container button:active {
            background-color: #737e74;
        }



    </style>
</head>

<body>
    <div class = "tit">
        <ul>
            <li><b>會員管理系統</b>
            <li><a aria-current="page" href="/create_member"> 新增</a>
            <li><a aria-current="page" href="/search_member" >查詢</a>
            <li><a aria-current="page" href="/shop_sys">購物車系統</a>
            <li><a aria-current="page" href="/shop_search" >購物車查詢</a>  
        </ul>
    </div><br>

    <div class="container">
        <div><p><b>會員查詢</b></p></div>

        <form action="/search_member" method="POST" id="searchForm">

            <table id="name1" border="1" rules="groups">

            <tr>
                <td>紀錄日期 </td>
                <td>開始日 
                    <input type="date" ame="start-date" size="10">           
                </td>
                <td > ~ 結束日
                    <input type="date" ame="end-date" size="10">
                </td>

                <td> 流水號 </td>

                <td> <input name="nunber" size="10"> </td>
            </tr>
            <tr>

            </tr>
            <tr>
                <td>國家</td>
                <td  >
                    <select id="select_country" name="select_country"  size="number" onchange="updateCities()">
                        <option value="" disabled selected>Select</option>
                        <option value="台灣">台灣</option>
                        <option value="美國">美國</option>
                        <option value="英國">英國</option>
                        <option value="中國">中國</option>
                    </select><br>

                </td>
                <td></td>


                <td>城市</td>
                <td>
                    <select name="select_city" id="select_city" size="number">
                        <option value="">請選擇國家以顯示城市</option>
                    </select><br>    
                </td>



            </tr>

            <tr>
                <td>專長</td>
                <td >
                    <select name="select_country"  size="number" onchange="updateCities()" >
                        <option value="" disabled selected>Select</option>
                        <option value="select_country">台灣
                        <option value="select_country">美國
                        <option value="select_country">英國
                        <option value="select_country">中國  
                    </select>
                </td>
                <td></td>


                <td>帳號</td>
                <td><input typr=“email” name="email" size="10"> </td>
                
            </tr>
            <tr>
                <td></td>
                <td ><th align="left" ><input type="submit" name="send" value="查詢"></th></td>
                <td></td>
                <td></td>

            </tr>
            </table>
        </form>

        <p></p>
        <% if (errorMessage) { %>
            <div class="alert">
                <p><%= errorMessage %></p>
            </div>
        <% } %>

        <% if (data && data.length > 0) { %>
            <table id="name2" border="1" rules="groups">
                <thead>
                    <tr>
                        <td>刪除</td>
                        <td>紀錄日期</td>
                        <td>帳號</td>
                        <td>國家</td>
                        <td>城市</td>
                        <td>姓名</td>
                        <td>性別</td>
                        <td>修改</td>
                    </tr>
                </thead>
                <tbody>
                    <% data.forEach(member => { %>
                        <tr>
                            <td><input type="checkbox" name="delete" value="<%= member.email %>"></td>
                            <td><%= member.recordDate %></td>
                            <td><%= member.email %></td>
                            <td><%= member.select_country %></td>
                            <td><%= member.select_city %></td>
                            <td><%= member.name %></td>
                            <td><%= member.sex %></td>
                            <td><button onclick="window.location.href='/edit_member/<%= member.email %>'">修改</button></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } else { %>
            <table id="name2" border="1" rules="groups">
                <thead>
                    <tr>
                        <td>刪除</td>
                        <td>紀錄日期</td>
                        <td>帳號</td>
                        <td>國家</td>
                        <td>城市</td>
                        <td>姓名</td>
                        <td>性別</td>
                        <td>修改</td>
                    </tr>
                </thead>
                <tbody>
                    <!-- 空的第一列 -->
                    <tr>
                        <td colspan="8">No data found</td>
                    </tr>
                </tbody>
            </table>
        <% } %>
    </div>


    <div class="delete-button-container">
        <button onclick="deleteSelectedMembers()" id="delete">刪除</button>
    </div>




</body>

</html>